<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-08-06 ëª© 08:15 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PX4 and ROS Programming Day 1</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Donghee Park" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://gongzhitaao.org/orgcss/org.css"/>
<style type="text/css">img {  width: auto ;  max-width: 100% ;  height: auto ;} </style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "left",
        displayIndent: "5em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "Neo-Euler"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "Neo-Euler"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "left",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">PX4 and ROS Programming Day 1</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb6ea196">1. ìì</a></li>
<li><a href="#org91da7c1">2. ëë¡  ì ì´ ìíí¸ì¨ì´ ìê° ë° ì¤ì¹</a></li>
<li><a href="#org8486234">3. PX4 ìê°</a>
<ul>
<li><a href="#orge50891d">3.1. PX4 ë¯¸ë¤ì¨ì´ ë° ì± êµ¬ì¡° ìê°</a></li>
</ul>
</li>
<li><a href="#org6b10a3b">4. Linux ì¬ì©íê¸°</a></li>
<li><a href="#orgb435642">5. PX4 ê°ë°íê²½ êµ¬ì± (+ROS)</a></li>
<li><a href="#orga30ecc4">6. PX4 Firmware Build</a>
<ul>
<li><a href="#orgd125b26">6.1. PX4 v.10.1 ë¤ì´ë¡ë</a></li>
<li><a href="#org1ff92ed">6.2. Gazebo ì¤í</a></li>
<li><a href="#orgfbe9487">6.3. QGroundControl ì¬ì©</a></li>
</ul>
</li>
<li><a href="#org576e9be">7. ROS íë¡ê·¸ëë°</a>
<ul>
<li><a href="#org8255317">7.1. ROS</a></li>
<li><a href="#orgf1c9ca7">7.2. ROS Nodes and Topics</a>
<ul>
<li><a href="#orga9edc4b">7.2.1. ROS Master Process</a></li>
<li><a href="#orgffe47ca">7.2.2. Topics</a></li>
<li><a href="#org1e5450a">7.2.3. Publish and Subscribe</a></li>
</ul>
</li>
<li><a href="#org811e7d1">7.3. ROS Message Passing</a></li>
<li><a href="#orga161815">7.4. ROS Services</a>
<ul>
<li><a href="#org2f5d76d">7.4.1. ìì: ì¹´ë©ë¼ ì´ë¯¸ì§ ì»ê¸°</a></li>
</ul>
</li>
<li><a href="#org9c5d672">7.5. ROS Turtlesim</a>
<ul>
<li><a href="#orge8df005">7.5.1. Turtlesim ì¤ííê¸°</a></li>
<li><a href="#org5266f99">7.5.2. Turtlesim ë¸ë ëª©ë¡</a></li>
<li><a href="#org098fdac">7.5.3. Turtlesim í í½ ëª©ë¡</a></li>
<li><a href="#orga25c604">7.5.4. Turtlesim í í½ ì ë³´</a></li>
<li><a href="#org1fcefbb">7.5.5. Turtlesim ë©ìì§ ì ë³´</a></li>
<li><a href="#orgb7e7eec">7.5.6. Turtlesim Echo a Topic</a></li>
<li><a href="#orgd492a7d">7.5.7. <code>rqt_graph</code></a></li>
</ul>
</li>
<li><a href="#org37c6c0d">7.6. MavROS</a>
<ul>
<li><a href="#org6ab5db9">7.6.1. MavROS ì¤ì¹ ë° ì¤í (ì´ë¯¸ ìëì¤ì¹ë¨, ìí´ëë¨)</a></li>
</ul>
</li>
<li><a href="#orgb369ffa">7.7. Gazebo ì¤í</a></li>
</ul>
</li>
<li><a href="#orged1b30c">8. ROS ë¸ë ê´ë¦¬</a>
<ul>
<li><a href="#orgab45160">8.1. ROS ë¸ë ì¤í ë° ê´ë¦¬</a></li>
<li><a href="#orgbb802e6">8.2. ROS ë¸ë ëªë ¹ ì¤ííê¸°. (MAVROS ìì£¼)</a>
<ul>
<li><a href="#orgf040f4f">8.2.1. Subscribe</a></li>
<li><a href="#orgc38cb01">8.2.2. Services</a></li>
<li><a href="#orgea97c80">8.2.3. Publish</a></li>
<li><a href="#orgd0f74f4">8.2.4. ì¤ìµ</a></li>
<li><a href="#org6430269">8.2.5. ì ì©í mavros ëªë ¹(ë¸ë) ëª¨ì</a></li>
</ul>
</li>
<li><a href="#org536f0e8">8.3. í í½ ë ì½ë: rosbag</a></li>
<li><a href="#orge768ad4">8.4. ì°¸ê³ </a></li>
</ul>
</li>
<li><a href="#org5a5205f">9. ROS ë¸ë ë§ë¤ê¸°</a>
<ul>
<li><a href="#org0ae1030">9.1. ìë¡ì´ ë¸ë ë§ë¤ê¸°</a>
<ul>
<li><a href="#org013a539">9.1.1. í¨í¤ì§ ë§ë¤ê¸°</a></li>
<li><a href="#orgfc35f7b">9.1.2. ë¸ë ì½ë ìì±</a></li>
<li><a href="#org16902aa">9.1.3. í¨í¤ì§ ë¹ë</a></li>
<li><a href="#orgbf4a56f">9.1.4. í¨í¤ì§ ë¸ë ì¤í</a></li>
<li><a href="#org12918a9">9.1.5. í´ë³´ê¸°: /mavros/state ì½ì´ì 1ì´ë§ë¤ ë¹í mode íë²ì© ì¶ë ¥</a></li>
<li><a href="#org3fd790d">9.1.6. í´ë³´ê¸° ê²°ê³¼:</a></li>
</ul>
</li>
<li><a href="#org598b9a5">9.2. ìë¡ì´ ë¸ë ë§ë¤ê¸°: ëë¡  ì´ë¥ ì°©ë¥</a></li>
<li><a href="#orgb133a15">9.3. ìë¡ì´ ë¸ë ë§ë¤ê¸°: <code>offb_node</code></a>
<ul>
<li><a href="#orgdbbe45b">9.3.1. launch íì¼ì ì´ì©íì¬ ë¸ë íë²ì ì¤í (ìµì)</a></li>
</ul>
</li>
<li><a href="#org1bf1d3e">9.4. ìë¡ì´ ë¸ë ë§ë¤ê¸°: <code>circle</code></a>
<ul>
<li><a href="#org1424c1c">9.4.1. í´ë³´ê¸°: ìì ëë¹ì ìëë¥¼ ë°ê¾¸ì´ ë³´ì. íí¸ (wn, r)</a></li>
</ul>
</li>
<li><a href="#orgb270567">9.5. ê³¼ì : í¤ë³´ëë¡ OFFBOARD ëª¨ë ì ì´íê¸°</a></li>
<li><a href="#orgc47b79c">9.6. ì°¸ê³ </a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgb6ea196" class="outline-2">
<h2 id="orgb6ea196"><span class="section-number-2">1</span> ìì</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>ëª©í: ëë¡  ì ì´ ìíí¸ì¨ì´ì ëí´ ì´í´í  ì ìê³ , íë¡ê·¸ëë° íê²½ì êµ¬ì¶í  ì ìë¤.</li>
<li>êµì¬: <a href="https://learn.dronemap.io/">https://learn.dronemap.io/</a></li>
<li>ì½ì¹: ë°ëí¬ dongheepark@gmail.com</li>
</ul>
</div>
</div>

<div id="outline-container-org91da7c1" class="outline-2">
<h2 id="org91da7c1"><span class="section-number-2">2</span> ëë¡  ì ì´ ìíí¸ì¨ì´ ìê° ë° ì¤ì¹</h2>
<div class="outline-text-2" id="text-2">
<ol class="org-ol">
<li>ìí¬ì ìê°, ì°¸ê°ì ìê°</li>

<li>PX4 ìê°, ROS ìê°</li>

<li>Linux ì¬ì©íê¸°</li>
</ol>
</div>
</div>

<div id="outline-container-org8486234" class="outline-2">
<h2 id="org8486234"><span class="section-number-2">3</span> PX4 ìê°</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li><a href="https://px4.io/">https://px4.io/</a>
<ul class="org-ul">
<li>Pixhawk</li>
<li>PX4 Firmware</li>
<li>Mavlink</li>
<li>QGroundControl</li>
</ul></li>
<li><a href="https://learn.dronemap.io/px4-workbook/px4-intro.html">https://learn.dronemap.io/px4-workbook/px4-intro.html</a>
<ul class="org-ul">
<li>ìíí¸ì¨ì´ ìí¤íì²</li>
<li>ìë®¬ë ì´í° í¬í¸ êµ¬ì±</li>
</ul></li>
</ul>
</div>

<div id="outline-container-orge50891d" class="outline-3">
<h3 id="orge50891d"><span class="section-number-3">3.1</span> PX4 ë¯¸ë¤ì¨ì´ ë° ì± êµ¬ì¡° ìê°</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>ëë í ë¦¬ êµ¬ì¡° ìê°</li>
<li>uORB</li>
<li>PX4 shell ì¬ì©íê¸°</li>
<li>hello-skyworld</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org6b10a3b" class="outline-2">
<h2 id="org6b10a3b"><span class="section-number-2">4</span> Linux ì¬ì©íê¸°</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>Ubuntu 18.04 ì¤ì¹</li>
<li>ì£¼ì ëªë ¹ì´ ìê°(íì¼ ì¡°ì, íë¡ê·¸ë¨ì¤ì¹, ìì¤í¬ë¦½í¸, git)</li>
</ul>

<p>
ls: íì¼ ëë ëë í ë¦¬ì ëª©ë¡ì ì¶ë ¥
</p>
<pre class="example">
ls
ls -al
</pre>

<p>
cd: ëë í ë¦¬ ì´ë
</p>
<pre class="example">
cd ~
cd ~/Downloads
</pre>

<p>
pwd: íì¬ ëë í ë¦¬ ì¶ë ¥
</p>
<pre class="example">
pwd
</pre>

<p>
mkdir: ëë í ë¦¬ ìì±
</p>
<pre class="example">
mkdir tmp
</pre>

<p>
rm: íì¼ ëë ëë í ë¦¬ ì§ì°ê¸°
</p>
<pre class="example">
rm -rf tmp
</pre>

<p>
cat: íì¼ ìë ¥ ëë ì¶ë ¥
</p>
<pre class="example">
cat ~/.bashrc
cat &gt; ~/.hello.c
</pre>

<p>
cp: íì¼ ëë ëë í ë¦¬ ë³µì¬
</p>
<pre class="example">
cp hello.c world.c
</pre>

<p>
chmod: íì¼ì í¼ë¯¸ì ì§ì 
</p>
<pre class="example">
chmod +x hello
</pre>

<p>
wget: urlìì íì¼ ë¤ì´ë¡ë
</p>
<pre class="example">
wget https://google.com
</pre>

<p>
source: íì¬ ììì íì¼ì ì½ê³  ì¤í
</p>
<pre class="example">
source ~/.bashrc
</pre>
</div>
</div>


<div id="outline-container-orgb435642" class="outline-2">
<h2 id="orgb435642"><span class="section-number-2">5</span> PX4 ê°ë°íê²½ êµ¬ì± (+ROS)</h2>
<div class="outline-text-2" id="text-5">
<p>
<a href="https://dev.px4.io/master/en/setup/dev_env_linux_ubuntu.html">https://dev.px4.io/master/en/setup/dev_env_linux_ubuntu.html</a>
</p>

<pre class="example">
cd ~
wget https://raw.githubusercontent.com/PX4/Devguide/master/build_scripts/ubuntu_sim_ros_melodic.sh
chmod +x ubuntu_sim_ros_melodic.sh
./ubuntu_sim_ros_melodic.sh
</pre>
</div>
</div>

<div id="outline-container-orga30ecc4" class="outline-2">
<h2 id="orga30ecc4"><span class="section-number-2">6</span> PX4 Firmware Build</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li><a href="https://dev.px4.io">https://dev.px4.io</a></li>
<li>Gazebo ì¬ì©íê¸°</li>
<li>Qgroundcontrol</li>
</ul>
</div>

<div id="outline-container-orgd125b26" class="outline-3">
<h3 id="orgd125b26"><span class="section-number-3">6.1</span> PX4 v.10.1 ë¤ì´ë¡ë</h3>
<div class="outline-text-3" id="text-6-1">
<pre class="example">
cd ~
git clone https://github.com/PX4/Firmware.git --recursive
cd ~/Firmware
bash ./Tools/setup/ubuntu.sh
git checkout v1.10.1
git submodule update --init --recursive
</pre>
</div>
</div>

<div id="outline-container-org1ff92ed" class="outline-3">
<h3 id="org1ff92ed"><span class="section-number-3">6.2</span> Gazebo ì¤í</h3>
<div class="outline-text-3" id="text-6-2">
<pre class="example">
cd ~/Firmware
make px4_sitl gazebo
</pre>
</div>
</div>

<div id="outline-container-orgfbe9487" class="outline-3">
<h3 id="orgfbe9487"><span class="section-number-3">6.3</span> QGroundControl ì¬ì©</h3>
<div class="outline-text-3" id="text-6-3">
<p>
ë¤ì´ë¡ë: <a href="https://docs.qgroundcontrol.com/en/getting_started/download_and_install.html">https://docs.qgroundcontrol.com/en/getting_started/download_and_install.html</a>
</p>

<p>
QGroundControl ë¤ì´ë¡ë ë° ì¤í
</p>
<pre class="example">
sudo usermod -a -G dialout $USER
sudo apt-get remove modemmanager -y
sudo apt install gstreamer1.0-plugins-bad gstreamer1.0-libav gstreamer1.0-gl -y

cd ~/Downloads
chmod +x ./QGroundControl.AppImage
./QGroundControl.AppImage
</pre>
</div>
</div>
</div>


<div id="outline-container-org576e9be" class="outline-2">
<h2 id="org576e9be"><span class="section-number-2">7</span> ROS íë¡ê·¸ëë°</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org8255317" class="outline-3">
<h3 id="org8255317"><span class="section-number-3">7.1</span> ROS</h3>
<div class="outline-text-3" id="text-7-1">
<ul class="org-ul">
<li>Robot Operating System: ë¡ë´ ë¹ëì ì¬ì©ëë ë¼ì´ë¸ë¬ë¦¬ ì´íë¦¬ì¼ì´ì ëª¨ì <a href="http://www.ros.org/">http://www.ros.org/</a></li>
<li>ëª©í: ë¡ë´ì ë§ë¤ë ê¸°ì¡´ì ì¬íì© íê³  ê³µì íì.</li>
<li>History:
<ul class="org-ul">
<li>2000s: Standford Artificial intelligence</li>
<li>2007: Willow Garage</li>
<li>2013: Open Source Robotics Foundation</li>
</ul></li>
<li>ì¬ì© ë¶ì¼: Drone, Kinematic ARMS(ë¡ë´ì), Wheeled(ë°í´), Bi-pedal(ì´ì¡±)</li>
</ul>
</div>
</div>

<div id="outline-container-orgf1c9ca7" class="outline-3">
<h3 id="orgf1c9ca7"><span class="section-number-3">7.2</span> ROS Nodes and Topics</h3>
<div class="outline-text-3" id="text-7-2">

<div class="figure">
<p><img src="ros_nodes_and_topics1.png" alt="ros_nodes_and_topics1.png" />
</p>
</div>
</div>

<ol class="org-ol">
<li><a id="org7f28a1e"></a>Perception: Sense<br />
<div class="outline-text-5" id="text-7-2-0-1">
<ul class="org-ul">
<li>Sensor Fusion</li>
<li>Filtering</li>
<li>Localization</li>
</ul>
</div>
</li>

<li><a id="org499113c"></a>Dicesion Making: Decide<br />
<div class="outline-text-5" id="text-7-2-0-2">
<ul class="org-ul">
<li>Path Planning</li>
<li>Prediction</li>
<li>Behavior Planning</li>
</ul>
</div>
</li>

<li><a id="orge26a1c1"></a>Actuation: Act<br />
<div class="outline-text-5" id="text-7-2-0-3">
<ul class="org-ul">
<li>PID Control</li>
<li>Model Predictive Control</li>
</ul>
</div>
</li>
</ol>

<div id="outline-container-orga9edc4b" class="outline-4">
<h4 id="orga9edc4b"><span class="section-number-4">7.2.1</span> ROS Master Process</h4>
<div class="outline-text-4" id="text-7-2-1">
<p>
ë¸ë ê´ë¦¬
</p>


<div class="figure">
<p><img src="ros_master_process1.png" alt="ros_master_process1.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgffe47ca" class="outline-4">
<h4 id="orgffe47ca"><span class="section-number-4">7.2.2</span> Topics</h4>
<div class="outline-text-4" id="text-7-2-2">
<p>
ë¸ëê° íµì  ì¸í°íì´ì¤. êµ¬ë ë°íì ì´ë¦
</p>


<div class="figure">
<p><img src="ros_topic1.png" alt="ros_topic1.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org1e5450a" class="outline-4">
<h4 id="org1e5450a"><span class="section-number-4">7.2.3</span> Publish and Subscribe</h4>
<div class="outline-text-4" id="text-7-2-3">
<p>
ë°íê³¼ êµ¬ë. ì ë¬¸/ì¡ì§ ë°í êµ¬ëì ë¹ì 
</p>


<div class="figure">
<p><img src="ros_publish_and_subscribe1.png" alt="ros_publish_and_subscribe1.png" />
</p>
</div>

<p>
ì¤ì  ìì 
</p>


<div class="figure">
<p><img src="ros_publish_and_subscribe2.png" alt="ros_publish_and_subscribe2.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org811e7d1" class="outline-3">
<h3 id="org811e7d1"><span class="section-number-3">7.3</span> ROS Message Passing</h3>
<div class="outline-text-3" id="text-7-3">
<p>
ë©ìì§: ë¸ëê° íµì í ë ì´ëíë ì¤ì  ë°ì´í°
</p>
<ul class="org-ul">
<li>ë©ìì§ë íì¤í¸ë¡ êµ¬ì±. ë©ìì§ë¥¼ ì´í´íê¸° ì½ë¤.</li>
</ul>

<p>
ë¯¸ë¦¬ ì ìë ë©ìì§ íì :
</p>
<ul class="org-ul">
<li><a href="http://wiki.ros.org/common_msgs">http://wiki.ros.org/common_msgs</a></li>
<li><a href="https://github.com/ros/common_msgs">https://github.com/ros/common_msgs</a></li>
</ul>
</div>
</div>

<div id="outline-container-orga161815" class="outline-3">
<h3 id="orga161815"><span class="section-number-3">7.4</span> ROS Services</h3>
<div class="outline-text-3" id="text-7-4">
<ul class="org-ul">
<li>Request-Response, 1:1 íµì </li>
<li>PubSubì´ íì ìë ê²½ì° ì¬ì©, ìì²­ í ëë§ ë°ì´í°ê° ì ê³µ. ë¤í¸ìí¬ ë¶íê° ì ë¤.</li>
</ul>
</div>

<div id="outline-container-org2f5d76d" class="outline-4">
<h4 id="org2f5d76d"><span class="section-number-4">7.4.1</span> ìì: ì¹´ë©ë¼ ì´ë¯¸ì§ ì»ê¸°</h4>
<div class="outline-text-4" id="text-7-4-1">

<div class="figure">
<p><img src="ros_services1.png" alt="ros_services1.png" />
</p>
</div>


<div class="figure">
<p><img src="ros_services2.png" alt="ros_services2.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org9c5d672" class="outline-3">
<h3 id="org9c5d672"><span class="section-number-3">7.5</span> ROS Turtlesim</h3>
<div class="outline-text-3" id="text-7-5">
<p>
Turtle
</p>


<div class="figure">
<p><img src="https://i.imgur.com/0r46gFH.png" alt="0r46gFH.png" />
</p>
</div>
</div>

<div id="outline-container-orge8df005" class="outline-4">
<h4 id="orge8df005"><span class="section-number-4">7.5.1</span> Turtlesim ì¤ííê¸°</h4>
<div class="outline-text-4" id="text-7-5-1">

<div class="figure">
<p><img src="https://d17h27t6h515a5.cloudfront.net/topher/2017/March/58d9820b_running-turtlesim/running-turtlesim.png" alt="running-turtlesim.png" />
</p>
</div>


<ol class="org-ol">
<li>íê²½ ë³ì ì¤ì </li>
</ol>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #C586C0;">source</span> /opt/ros/melodic/setup.bash
</pre>
</div>

<ol class="org-ol">
<li>roscore ì¤í
<ul class="org-ul">
<li>roscore: Master + rosout + parameter server
<ul class="org-ul">
<li>Master: ë¤ì ìë¹ì¤</li>
<li>rosout: stdout/stderr ë¡ê¹</li>
<li>parameter server: íë¼ë¯¸í° ì ì¥ ìë²</li>
</ul></li>
</ul></li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">roscore
</pre>
</div>

<ol class="org-ol">
<li>turtlesim í¨í¤ì§ì <code>turtlesim_node</code> ì¤í</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">rosrun turtlesim turtlesim_node
</pre>
</div>

<ol class="org-ol">
<li>turtlesim í¨í¤ì§ì <code>turtle_teleop_key</code> ì¤í</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">rosrun turtlesim turtle_teleop_key
</pre>
</div>
</div>
</div>

<div id="outline-container-org5266f99" class="outline-4">
<h4 id="org5266f99"><span class="section-number-4">7.5.2</span> Turtlesim ë¸ë ëª©ë¡</h4>
<div class="outline-text-4" id="text-7-5-2">
<div class="org-src-container">
<pre class="src src-sh">rosnode list
</pre>
</div>

<p>
/rosout : ROS ë©ìì§ ë¡ê¹.
</p>
</div>
</div>

<div id="outline-container-org098fdac" class="outline-4">
<h4 id="org098fdac"><span class="section-number-4">7.5.3</span> Turtlesim í í½ ëª©ë¡</h4>
<div class="outline-text-4" id="text-7-5-3">
<div class="org-src-container">
<pre class="src src-sh">rostopic list
</pre>
</div>
</div>
</div>

<div id="outline-container-orga25c604" class="outline-4">
<h4 id="orga25c604"><span class="section-number-4">7.5.4</span> Turtlesim í í½ ì ë³´</h4>
<div class="outline-text-4" id="text-7-5-4">
<div class="org-src-container">
<pre class="src src-sh">rostopic info /turtle1/cmd_vel

</pre>
</div>
</div>
</div>

<div id="outline-container-org1fcefbb" class="outline-4">
<h4 id="org1fcefbb"><span class="section-number-4">7.5.5</span> Turtlesim ë©ìì§ ì ë³´</h4>
<div class="outline-text-4" id="text-7-5-5">
<div class="org-src-container">
<pre class="src src-sh">$ rosmsg info geometry_msgs/Twist
geometry_msgs/Vector3 linear
  float64 x
  float64 y
  float64 z
geometry_msgs/Vector3 angular
  float64 x
  float64 y
  float64 z
</pre>
</div>

<p>
or
</p>

<div class="org-src-container">
<pre class="src src-sh">rosed geometry_msgs Twist.msg
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb7e7eec" class="outline-4">
<h4 id="orgb7e7eec"><span class="section-number-4">7.5.6</span> Turtlesim Echo a Topic</h4>
<div class="outline-text-4" id="text-7-5-6">
<p>
ëë²ê¹ì í¸ë¦¬
</p>

<div class="org-src-container">
<pre class="src src-sh">rostopic echo /turtle1/cmd_vel
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd492a7d" class="outline-4">
<h4 id="orgd492a7d"><span class="section-number-4">7.5.7</span> <code>rqt_graph</code></h4>
<div class="outline-text-4" id="text-7-5-7">
<div class="org-src-container">
<pre class="src src-sh">rqt_graph
</pre>
</div>


<div class="figure">
<p><img src="http://wiki.ros.org/rqt_graph?action=AttachFile&amp;do=get&amp;target=snap_rqt_graph_moveit_demo.png" alt="rqt_graph?action=AttachFile&amp;do=get&amp;target=snap_rqt_graph_moveit_demo.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org37c6c0d" class="outline-3">
<h3 id="org37c6c0d"><span class="section-number-3">7.6</span> MavROS</h3>
<div class="outline-text-3" id="text-7-6">
<p>
<a href="http://wiki.ros.org/mavros">http://wiki.ros.org/mavros</a> mavlink ros wrapper
</p>


<div class="figure">
<p><img src="https://i.imgur.com/9z8DEIn.png" alt="9z8DEIn.png" />
</p>
</div>
</div>

<div id="outline-container-org6ab5db9" class="outline-4">
<h4 id="org6ab5db9"><span class="section-number-4">7.6.1</span> MavROS ì¤ì¹ ë° ì¤í (ì´ë¯¸ ìëì¤ì¹ë¨, ìí´ëë¨)</h4>
<div class="outline-text-4" id="text-7-6-1">
<div class="org-src-container">
<pre class="src src-sh">
<span style="color: #ff0000;">## </span><span style="color: #579C4C;">Create catkin workspace (ROS build system)</span>
mkdir -p ~/catkin_ws/src
<span style="color: #C586C0;">cd</span> ~/catkin_ws

<span style="color: #ff0000;">## </span><span style="color: #579C4C;">Install dependencies</span>
sudo apt-get install python-wstool python-rosinstall-generator python-catkin-tools -y

<span style="color: #ff0000;">## </span><span style="color: #579C4C;">Initialise wstool</span>
wstool init ~/catkin_ws/src

<span style="color: #ff0000;">## </span><span style="color: #579C4C;">Build MAVROS</span>
<span style="color: #ff0000;">### </span><span style="color: #579C4C;">Get source (upstream - released)</span>
rosinstall_generator --upstream mavros --rosdistro kinetic | tee /tmp/mavros.rosinstall
<span style="color: #ff0000;">### </span><span style="color: #579C4C;">Get latest released mavlink package</span>
rosinstall_generator mavlink --rosdistro kinetic | tee -a /tmp/mavros.rosinstall
<span style="color: #ff0000;">### </span><span style="color: #579C4C;">Setup workspace &amp; install deps</span>
wstool merge -t src /tmp/mavros.rosinstall
wstool update -t src
rosdep install --from-paths src --ignore-src --rosdistro kinetic -y

<span style="color: #ff0000;">### </span><span style="color: #579C4C;">Install GeographicLib datasets</span>
./src/mavros/mavros/scripts/install_geographiclib_datasets.sh

<span style="color: #ff0000;">### </span><span style="color: #579C4C;">Build source</span>
catkin build

<span style="color: #ff0000;">### </span><span style="color: #579C4C;">source setup.bash</span>
<span style="color: #C586C0;">source</span> devel/setup.bash

</pre>
</div>

<p>
íê²½ë³ì ì¤ì : workspace
</p>

<pre class="example">
cd ~/catkin_ws
source devel/setup.bash
</pre>

<p>
<code>mavros_node</code> ì¤í
</p>

<div class="org-src-container">
<pre class="src src-sh">rosrun mavros mavros_node _fcu_url:=<span style="color: #DB8E73;">"udp://:14540@127.0.0.1:14557"</span> _gcs_url:=<span style="color: #DB8E73;">"udp://@127.0.0.1"</span>
</pre>
</div>

<p>
<code>mavros_node</code> ì¤í (roslaunch ì¬ì©íë ë°©ë²)
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ff0000;"># </span><span style="color: #579C4C;">px4.launch &#51060;&#50857;&#54616;&#50668; mavros node &#49892;&#54665;. fcu ip&#51452;&#49548;&#45716; 127.0.0.1 ip&#51452;&#49548;&#47484; &#48148;&#44984;&#47732; &#45796;&#47480; &#52980;&#54504;&#53552;&#51032; fcu&#46020; &#50672;&#44208; &#44032;&#45733;.</span>
<span style="color: #C586C0;">cd</span> ~/catkin_ws
roslaunch mavros px4.launch fcu_url:=<span style="color: #DB8E73;">"udp://:14540@127.0.0.1:14557"</span> _gcs_url:<span style="color: #DB8E73;">"udp://@127.0.0.1"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb369ffa" class="outline-3">
<h3 id="orgb369ffa"><span class="section-number-3">7.7</span> Gazebo ì¤í</h3>
<div class="outline-text-3" id="text-7-7">
<p>
ìë®¬ë ì´í°ì í ìì¹(ìë ê²½ë í´ë°ê³ ë) ì§ì 
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #C586C0;">export</span> <span style="color: #85DDFF; font-weight: bold;">PX4_HOME_LAT</span>=35.9012382
<span style="color: #C586C0;">export</span> <span style="color: #85DDFF; font-weight: bold;">PX4_HOME_LON</span>=128.854495337
<span style="color: #C586C0;">export</span> <span style="color: #85DDFF; font-weight: bold;">PX4_HOME_ALT</span>=71

make posix_sitl gazebo
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orged1b30c" class="outline-2">
<h2 id="orged1b30c"><span class="section-number-2">8</span> ROS ë¸ë ê´ë¦¬</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-orgab45160" class="outline-3">
<h3 id="orgab45160"><span class="section-number-3">8.1</span> ROS ë¸ë ì¤í ë° ê´ë¦¬</h3>
<div class="outline-text-3" id="text-8-1">
</div>
<ol class="org-ol">
<li><a id="orge9eb706"></a>ROS Core ë¸ë ì¤í<br />
<div class="outline-text-5" id="text-8-1-0-1">
<div class="org-src-container">
<pre class="src src-sh">roscore
</pre>
</div>
</div>
</li>

<li><a id="org3256cd3"></a>MAVROS ë¸ë ì¤í<br />
<div class="outline-text-5" id="text-8-1-0-2">
<div class="org-src-container">
<pre class="src src-sh">roslaunch mavros px4.launch

rosrun mavros mavros_node _fcu_url:=<span style="color: #DB8E73;">"udp://:14540@127.0.0.1:14557"</span> _gcs_url:=<span style="color: #DB8E73;">"udp://@127.0.0.1"</span>
</pre>
</div>
</div>
</li>

<li><a id="org95c0e57"></a>í í½ ëª©ë¡<br />
<div class="outline-text-5" id="text-8-1-0-3">
<div class="org-src-container">
<pre class="src src-sh">rostopic list
</pre>
</div>
</div>
</li>

<li><a id="org1db8870"></a>í í½ ë´ì© ë³´ê¸°<br />
<ol class="org-ol">
<li><a id="orgaa1113c"></a>ë©ìì§ íì ë³´ê¸°<br />
<div class="outline-text-6" id="text-8-1-0-4-1">
<div class="org-src-container">
<pre class="src src-sh">rostopic info /mavros/state
</pre>
</div>

<p>
íì ë´ë¶ ë³´ê¸°
</p>
<div class="org-src-container">
<pre class="src src-sh">rostopic type /mavros/state | rosmsg show
</pre>
</div>
</div>
</li>

<li><a id="orgcdb648f"></a>ë©ìì§ ë´ì©<br />
<div class="outline-text-6" id="text-8-1-0-4-2">
<div class="org-src-container">
<pre class="src src-sh">rostopic echo /mavros/state
</pre>
</div>
</div>
</li>

<li><a id="org677e4ae"></a>í í½ publish ì£¼ê¸° ë³´ê¸°<br />
<div class="outline-text-6" id="text-8-1-0-4-3">
<div class="org-src-container">
<pre class="src src-sh">rostopic hz /mavros/state
</pre>
</div>
</div>
</li>

<li><a id="orgf6db5e9"></a>ì¤í ë¸ë íì¸<br />
<div class="outline-text-6" id="text-8-1-0-4-4">
<div class="org-src-container">
<pre class="src src-sh">rqt_graph
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>

<div id="outline-container-orgbb802e6" class="outline-3">
<h3 id="orgbb802e6"><span class="section-number-3">8.2</span> ROS ë¸ë ëªë ¹ ì¤ííê¸°. (MAVROS ìì£¼)</h3>
<div class="outline-text-3" id="text-8-2">
<p>
<a href="http://wiki.ros.org/ROS/Tutorials/UnderstandingTopics">http://wiki.ros.org/ROS/Tutorials/UnderstandingTopics</a>
</p>
</div>

<div id="outline-container-orgf040f4f" class="outline-4">
<h4 id="orgf040f4f"><span class="section-number-4">8.2.1</span> Subscribe</h4>
<div class="outline-text-4" id="text-8-2-1">
<div class="org-src-container">
<pre class="src src-sh">rostopic echo [topic]
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="orgb952c4c"></a><code>STATE</code><br />
<div class="outline-text-5" id="text-8-2-1-1">
<div class="org-src-container">
<pre class="src src-sh">rostopic echo /mavros/state
</pre>
</div>
</div>
</li>

<li><a id="org9f7048c"></a><code>LOCAL_POSITION</code> íì¸<br />
<div class="outline-text-5" id="text-8-2-1-2">
<div class="org-src-container">
<pre class="src src-sh">rostopic echo /mavros/local_position/pose
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgc38cb01" class="outline-4">
<h4 id="orgc38cb01"><span class="section-number-4">8.2.2</span> Services</h4>
<div class="outline-text-4" id="text-8-2-2">
</div>
<ol class="org-ol">
<li><a id="org4bd032a"></a>ìë¹ì¤ ëª©ë¡<br />
<div class="outline-text-5" id="text-8-2-2-1">
<div class="org-src-container">
<pre class="src src-sh">rosservice listp
</pre>
</div>
</div>
</li>

<li><a id="orge0ffc85"></a>ìë¹ì¤ ì¤í(call)<br />
<div class="outline-text-5" id="text-8-2-2-2">
<div class="org-src-container">
<pre class="src src-sh">rosservice call [topic] [msg_type] [args]
</pre>
</div>
</div>
</li>

<li><a id="orgbf07858"></a><code>SET_MODE</code><br />
<div class="outline-text-5" id="text-8-2-2-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ff0000;"># </span><span style="color: #579C4C;">https://github.com/mavlink/mavros/blob/master/mavros_msgs/srv/SetMode.srv</span>
<span style="color: #ff0000;"># </span><span style="color: #579C4C;">http://wiki.ros.org/mavros/CustomModes</span>
<span style="color: #ff0000;"># </span><span style="color: #579C4C;">Manual Mode</span>
rosservice call /mavros/set_mode <span style="color: #DB8E73;">"base_mode: 64</span>
<span style="color: #DB8E73;">custom_mode: ''"</span>

rosservice call /mavros/set_mode <span style="color: #DB8E73;">"base_mode: 0</span>
<span style="color: #DB8E73;">custom_mode: 'MANUAL'"</span>

rosservice call /mavros/set_mode <span style="color: #DB8E73;">"base_mode: 0</span>
<span style="color: #DB8E73;">custom_mode: 'POSCTL'"</span>

rosservice call /mavros/set_mode <span style="color: #DB8E73;">"base_mode: 0</span>
<span style="color: #DB8E73;">custom_mode: 'OFFBOARD'"</span>

rosservice call /mavros/set_mode <span style="color: #DB8E73;">"base_mode: 0</span>
<span style="color: #DB8E73;">custom_mode: 'AUTO.LAND'"</span>
</pre>
</div>
</div>
</li>

<li><a id="orgbacdbe8"></a><code>ARMING</code><br />
<div class="outline-text-5" id="text-8-2-2-4">
<div class="org-src-container">
<pre class="src src-sh">rosservice call /mavros/cmd/arming <span style="color: #DB8E73;">"value: true"</span>
</pre>
</div>
</div>
</li>

<li><a id="org8cfc28b"></a><code>TAKEOFF</code><br />
<div class="outline-text-5" id="text-8-2-2-5">
<div class="org-src-container">
<pre class="src src-sh">rosservice call /mavros/cmd/takeoff <span style="color: #DB8E73;">"{min_pitch: 0.0, yaw: 0.0, latitude: 47.3977508, longitude: 8.5456074, altitude: 2.5}"</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgea97c80" class="outline-4">
<h4 id="orgea97c80"><span class="section-number-4">8.2.3</span> Publish</h4>
<div class="outline-text-4" id="text-8-2-3">
<div class="org-src-container">
<pre class="src src-sh">rostopic pub [topic] [msg_type] [args]
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="org5756853"></a><code>SETPOINT_POSITION</code><br />
<div class="outline-text-5" id="text-8-2-3-1">
<p>
OFFBOARD ëª¨ëìì ëì
</p>

<div class="org-src-container">
<pre class="src src-sh">rostopic pub -r 10 /mavros/setpoint_position/local geometry_msgs/PoseStamped <span style="color: #DB8E73;">"header:</span>
<span style="color: #DB8E73;">  auto</span>
<span style="color: #DB8E73;">pose:</span>
<span style="color: #DB8E73;">  position:</span>
<span style="color: #DB8E73;">    x: 5.0</span>
<span style="color: #DB8E73;">    y: 0.0</span>
<span style="color: #DB8E73;">    z: 1.0</span>
<span style="color: #DB8E73;">  orientation:</span>
<span style="color: #DB8E73;">    x: 0.0</span>
<span style="color: #DB8E73;">    y: 0.0</span>
<span style="color: #DB8E73;">    z: 0.0</span>
<span style="color: #DB8E73;">    w: 0.0"</span>
</pre>
</div>
</div>
</li>

<li><a id="orgc460760"></a><code>SETPOINT_VELOCITY</code><br />
<div class="outline-text-5" id="text-8-2-3-2">
<p>
OFFBOARD ëª¨ëìì ëì
</p>

<div class="org-src-container">
<pre class="src src-sh">rostopic pub -r 10 /mavros/setpoint_velocity/cmd_vel geometry_msgs/TwistStamped <span style="color: #DB8E73;">"{header: auto, twist: {linear: {x: 10.0, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 0.0}}}"</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgd0f74f4" class="outline-4">
<h4 id="orgd0f74f4"><span class="section-number-4">8.2.4</span> ì¤ìµ</h4>
<div class="outline-text-4" id="text-8-2-4">
<p>
ì¤ë¹: ììëë¡ ì¤í
</p>
<ul class="org-ul">
<li>Gazebo ì¤í: <code>cd ~/Firmware; make posix_sitl gazebo</code></li>
<li>PCì MAVROSë¥¼ PC(127.0.0.1)ì Gazeboì ì°ê²° <code>rosrun mavros mavros_node _fcu_url:="udp://:14540@127.0.0.1:14557" _gcs_url:="udp://@127.0.0.1"</code> <br />
ëë Raspberry PIì MAVROSë¥¼ PC(192.168.88.53)ì Gazeboì ì°ê²°. Raspberry PIìì ë¤ì ëªë ¹ì ì¤í <code>roslaunch mavros px4.launch fcu_url:="udp://:14540@192.168.88.53:14557" gcs_url:="udp://@192.168.88.53"</code></li>
<li>QGroundControl ì¤í: PX4 Parameter <code>COM_OF_LOSS_T</code> íë¼ë¯¸í° 15ì´ë¡ ë°ê¾¸ê¸°. Failsafe timeoutì 15ì´ë¡ ë°ê¾¸ì´ì¼ ì»¤ë§¨ëë¼ì¸ìì ëë¡ ì ì¡°ì íê¸° í¸íë¤.</li>
</ul>

<p>
<br />
</p>

<p>
í´ë³´ê¸°: ì»¤ë§¨ë ë¼ì¸ìì ë¤ì ëªë ¹ì ìííì¬, QGroundControlì ìëì ê°ì ìì·¨ë¥¼ ë¨ê²¨ë³´ì.
</p>
<ul class="org-ul">
<li>1. ARM</li>
<li>2. TAKEOFF íê³ . (ìµì)</li>
<li>3. íì¬ ìì¹ë¥¼ ì§ì íë¤.  <code>/mavros/setpoint_position</code> ì´ì©íì¬, (0,0,0) ìì¹ë¥¼ 10hzë¡ ì§ì </li>
<li>3-1. MODE ë³í. OFFBOARD</li>
<li>4. 20m ê°ê²©ì¼ë¡ ì ì¬ê°íì ë°ë¼ ìì§ì¸ë¤. <code>/mavros/setpoint_position</code> ì´ì©</li>
<li>5. HOME ìë¦¬ì ì¤ë©´ LAND íë¤.</li>
<li>6. DISARM</li>
</ul>


<div class="figure">
<p><img src="https://i.imgur.com/4IjvTca.png" alt="4IjvTca.png" />
</p>
</div>

<p>
ëí´ë³´ê¸°: ëë¡ ì ë¨¸ë¦¬ë°©í¥ì´ ì§í ë°©í¥ì í¥íëë¡ íì.
</p>

<ul class="org-ul">
<li>Body 3-2-1 ìì ì¤ì¼ë¬-&gt;ì¿¼í°ëì¸ ë³í</li>
</ul>

\begin{align}
\begin{bmatrix}
x \\
y \\
z \\
w \\
\end{bmatrix}
& =
\begin{bmatrix}
\cos (\phi /2) \cos (\theta /2) \cos (\psi /2) +  \sin (\phi /2) \sin (\theta /2) \sin (\psi /2) \\
\sin (\phi /2) \cos (\theta /2) \cos (\psi /2) -  \cos (\phi /2) \sin (\theta /2) \sin (\psi /2) \\
\cos (\phi /2) \sin (\theta /2) \cos (\psi /2) +  \sin (\phi /2) \cos (\theta /2) \sin (\psi /2) \\
\cos (\phi /2) \cos (\theta /2) \sin (\psi /2) -  \sin (\phi /2) \sin (\theta /2) \cos (\psi /2) \\
\end{bmatrix} \\
\end{align}

<p>
ë³í ì½ë(python): <a href="https://gist.github.com/donghee/e3b4fa8ec789cec0e287bf3b91ddb79e">https://gist.github.com/donghee/e3b4fa8ec789cec0e287bf3b91ddb79e</a>
</p>
</div>
</div>

<div id="outline-container-org6430269" class="outline-4">
<h4 id="org6430269"><span class="section-number-4">8.2.5</span> ì ì©í mavros ëªë ¹(ë¸ë) ëª¨ì</h4>
<div class="outline-text-4" id="text-8-2-5">
<p>
mavros í¨í¤ì§ì mavsafety ë¸ë: arm, disarm, safetyarea
</p>

<pre class="example">
rosrun mavros mavsafety arm
</pre>

<p>
mavcmd ë¸ë:
</p>

<p>
ìì: takeoff from current position (10ë ê°ë í¼ì¹, 90ë ë°©í¥ ë³´ê³ , 5m ìë¡ takeoff)
</p>
<pre class="example">
rosrun mavros mavcmd takeoffcur 10 90 5
</pre>

<p>
ìì: home ì§ì (RTL ìì¹, ìë 35.9012382 ê²½ë 128.85449537 í´ë°ê³ ë 71m)
google earth: <a href="https://earth.google.com/web/search/35.9012382+128.85449537">https://earth.google.com/web/search/35.9012382+128.85449537</a>
</p>
<pre class="example">
rosrun mavros mavcmd sethome 35.9012382 128.854495337 71
</pre>

<p>
mavsetp ë¸ë: setpoint íë² ë³´ë´ê¸° (setpoint íì¤í¸ì©, position, velocity, acceleration ê°ë¥)
</p>

<p>
ìì: x=1m, y=1m, z=1m, yaw=90ë setpoint ë³´ë´ê¸°
</p>
<pre class="example">
rosrun mavros mavsetp local -p 1 1 2 90
</pre>

<p>
mavsys ë¸ë: change mode
</p>
<pre class="example">
rosrun mavros mavsys mode -c OFFBOARD
</pre>

<p>
mavparam ë¸ë: parameter set, get, load, dump
</p>

<p>
ìì: íë¼ë¯¸í° ë¤í
</p>
<pre class="example">
rosrun mavros mavparam dump /tmp/params
</pre>

<p>
mavftp ë¸ë: px4ì íì¼ ìì¤í ì ê·¼
</p>

<p>
ìì: ë¡ê·¸ ë¤ì´ë¡ë
</p>
<pre class="example">
rosrun mavros mavftp download log/2020-08-03/14_37_15.ul
</pre>
</div>
</div>
</div>


<div id="outline-container-org536f0e8" class="outline-3">
<h3 id="org536f0e8"><span class="section-number-3">8.3</span> í í½ ë ì½ë: rosbag</h3>
<div class="outline-text-3" id="text-8-3">
<p>
ë¦¬ë·°í ë ì ì©
</p>

<p>
í í½ ì ì¥íê¸°
</p>
<pre class="example">
rostopic list -v
mkdir ~/bagfiles
cd ~/bagfiles
rosbag record -O iris_default_1 /mavros/local_position/pose
rosbag info iris_default_1.bag
rqt_bag
</pre>
</div>
</div>

<div id="outline-container-orge768ad4" class="outline-3">
<h3 id="orge768ad4"><span class="section-number-3">8.4</span> ì°¸ê³ </h3>
<div class="outline-text-3" id="text-8-4">
<ul class="org-ul">
<li><a href="https://github.com/mavlink/mavros/tree/master/mavros">https://github.com/mavlink/mavros/tree/master/mavros</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org5a5205f" class="outline-2">
<h2 id="org5a5205f"><span class="section-number-2">9</span> ROS ë¸ë ë§ë¤ê¸°</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-org0ae1030" class="outline-3">
<h3 id="org0ae1030"><span class="section-number-3">9.1</span> ìë¡ì´ ë¸ë ë§ë¤ê¸°</h3>
<div class="outline-text-3" id="text-9-1">
</div>
<div id="outline-container-org013a539" class="outline-4">
<h4 id="org013a539"><span class="section-number-4">9.1.1</span> í¨í¤ì§ ë§ë¤ê¸°</h4>
<div class="outline-text-4" id="text-9-1-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #C586C0;">source</span> ~/catkin_ws/devel/setup.bash
<span style="color: #C586C0;">cd</span> ~/catkin_ws/src
catkin_create_pkg drone_control mavros sensor_msgs roscpp rospy
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc35f7b" class="outline-4">
<h4 id="orgfc35f7b"><span class="section-number-4">9.1.2</span> ë¸ë ì½ë ìì±</h4>
<div class="outline-text-4" id="text-9-1-2">
<p>
<code>~/catkin_ws/src/drone_control/src/drone_state.cpp</code>
</p>
<div class="org-src-container">
<pre class="src src-c++"><span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">"ros/ros.h"</span>
<span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">"sensor_msgs/Imu.h"</span>

<span style="color: #35CDAF;">void</span> <span style="color: #D9DAA2;">imuDataCallback</span>(<span style="color: #6959ce;">const</span> <span style="color: #339CDB;">sensor_msgs</span>::<span style="color: #339CDB;">Imu</span>::<span style="color: #35CDAF;">ConstPtr</span>&amp; <span style="color: #85DDFF; font-weight: bold;">msg</span>){
  ROS_INFO(<span style="color: #DB8E73;">"\nlinear acceleration\</span>
<span style="color: #DB8E73;">      \nx: [%f]\ny:[%f]\nz:[%f]"</span>, msg-&gt;linear_acceleration.x,
      msg-&gt;linear_acceleration.y, msg-&gt;linear_acceleration.z);
}

<span style="color: #35CDAF;">int</span> <span style="color: #D9DAA2;">main</span>(<span style="color: #35CDAF;">int</span> <span style="color: #85DDFF; font-weight: bold;">argc</span>, <span style="color: #35CDAF;">char</span> **<span style="color: #85DDFF; font-weight: bold;">argv</span>){
  <span style="color: #339CDB;">ros</span>::init(argc, argv, <span style="color: #DB8E73;">"drone_state"</span>);
  <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">NodeHandle</span> <span style="color: #85DDFF; font-weight: bold;">nh</span>;
  <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">Subscriber</span> <span style="color: #85DDFF; font-weight: bold;">sub</span> = nh.subscribe(<span style="color: #DB8E73;">"/mavros/imu/data"</span>, 1000, imuDataCallback);
  <span style="color: #339CDB;">ros</span>::spin();
  <span style="color: #6959ce;">return</span> 0;
}
</pre>
</div>

<p>
ë¹ë ì¤í¬ë¦½í¸ ì¶ê°
</p>

<p>
<code>~/catkin_ws/src/drone_control/CMakeLists.txt</code> íì¼ ëì ë¤ì 3ì¤ ì¶ê°
</p>

<div class="org-src-container">
<pre class="src src-cmake">include_directories(include ${catkin_INCLUDE_DIRS})
add_executable(drone_state src/drone_state.cpp)
target_link_libraries(drone_state ${catkin_LIBRARIES})
</pre>
</div>

<p>
íê²½ ë³ì ë¤ì ë¡ë!
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #C586C0;">source</span> ~/catkin_ws/devel/setup.bash
</pre>
</div>
</div>
</div>

<div id="outline-container-org16902aa" class="outline-4">
<h4 id="org16902aa"><span class="section-number-4">9.1.3</span> í¨í¤ì§ ë¹ë</h4>
<div class="outline-text-4" id="text-9-1-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #C586C0;">cd</span> ~/catkin_ws
catkin build
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf4a56f" class="outline-4">
<h4 id="orgbf4a56f"><span class="section-number-4">9.1.4</span> í¨í¤ì§ ë¸ë ì¤í</h4>
<div class="outline-text-4" id="text-9-1-4">
<p>
<code>drone_control</code> í¨í¤ì§ì <code>drone_state</code> ë¸ë ì¤í
</p>
<div class="org-src-container">
<pre class="src src-sh">rosrun drone_control drone_state
</pre>
</div>
</div>
</div>


<div id="outline-container-org12918a9" class="outline-4">
<h4 id="org12918a9"><span class="section-number-4">9.1.5</span> í´ë³´ê¸°: /mavros/state ì½ì´ì 1ì´ë§ë¤ ë¹í mode íë²ì© ì¶ë ¥</h4>
<div class="outline-text-4" id="text-9-1-5">
<ul class="org-ul">
<li><code>/mavros/state</code> íì ì²´í¬íì¬ í¤ë include</li>
</ul>

<div class="org-src-container">
<pre class="src src-c++">
<span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">"ros/ros.h"</span>
<span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">"mavros_msgs/State.h"</span>

<span style="color: #35CDAF;">void</span> <span style="color: #D9DAA2;">droneStateCallback</span>(<span style="color: #6959ce;">const</span> <span style="color: #339CDB;">mavros_msgs</span>::<span style="color: #339CDB;">State</span>::<span style="color: #35CDAF;">ConstPtr</span>&amp; <span style="color: #85DDFF; font-weight: bold;">msg</span>){
  ROS_INFO(<span style="color: #DB8E73;">"\nDrone mode: %s"</span>, msg-&gt;mode.c_str());
}

<span style="color: #35CDAF;">int</span> <span style="color: #D9DAA2;">main</span>(<span style="color: #35CDAF;">int</span> <span style="color: #85DDFF; font-weight: bold;">argc</span>, <span style="color: #35CDAF;">char</span> **<span style="color: #85DDFF; font-weight: bold;">argv</span>){
  <span style="color: #339CDB;">ros</span>::init(argc, argv, <span style="color: #DB8E73;">"drone_state"</span>);
  <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">NodeHandle</span> <span style="color: #85DDFF; font-weight: bold;">nh</span>;
  <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">Subscriber</span> <span style="color: #85DDFF; font-weight: bold;">sub</span> = nh.subscribe(<span style="color: #DB8E73;">"/mavros/state"</span>, 1000, droneStateCallback);
  <span style="color: #339CDB;">ros</span>::spin();
  <span style="color: #6959ce;">return</span> 0;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3fd790d" class="outline-4">
<h4 id="org3fd790d"><span class="section-number-4">9.1.6</span> í´ë³´ê¸° ê²°ê³¼:</h4>
<div class="outline-text-4" id="text-9-1-6">
<div class="org-src-container">
<pre class="src src-c++">$ rosrun drone_control drone_state
[ INFO] [1539297808.077868114]:
Drone mode: OFFBOARD
[ INFO] [1539297808.525173697]:
Drone mode: OFFBOARD
[ INFO] [1539297809.565387356]:
Drone mode: OFFBOARD
</pre>
</div>

<p>
<code>rqt_graph</code>
</p>


<div class="figure">
<p><img src="https://i.imgur.com/CGHQVwc.png" alt="CGHQVwc.png" />
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org598b9a5" class="outline-3">
<h3 id="org598b9a5"><span class="section-number-3">9.2</span> ìë¡ì´ ë¸ë ë§ë¤ê¸°: ëë¡  ì´ë¥ ì°©ë¥</h3>
<div class="outline-text-3" id="text-9-2">

<div class="figure">
<p><img src="mavros_takeoff_and_land1.png" alt="mavros_takeoff_and_land1.png" />
</p>
</div>

<p>
<code>drone_control</code> í¨í¤ì§ì <code>takeoff_and_land</code> ë¸ëë¥¼ ë§ë¤ì´ ë³´ì.
</p>

<p>
2.5m ì´ë¥í 10ì´ ìë¤ê° ì°©ë¥
</p>

<div class="org-src-container">
<pre class="src src-c++"><span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">&lt;cstdlib&gt;</span>

<span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">&lt;ros/ros.h&gt;</span>
<span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">&lt;mavros_msgs/CommandBool.h&gt;</span>
<span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">&lt;mavros_msgs/CommandTOL.h&gt;</span>
<span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">&lt;mavros_msgs/SetMode.h&gt;</span>

<span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">&lt;geometry_msgs/PoseStamped.h&gt;</span>

<span style="color: #35CDAF;">int</span> <span style="color: #D9DAA2;">main</span>(<span style="color: #35CDAF;">int</span> <span style="color: #85DDFF; font-weight: bold;">argc</span>, <span style="color: #35CDAF;">char</span> **<span style="color: #85DDFF; font-weight: bold;">argv</span>)
{

    <span style="color: #35CDAF;">int</span> <span style="color: #85DDFF; font-weight: bold;">rate</span> = 20;

    <span style="color: #339CDB;">ros</span>::init(argc, argv, <span style="color: #DB8E73;">"takeoff_and_land"</span>);
    <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">NodeHandle</span> <span style="color: #85DDFF; font-weight: bold;">n</span>;

    <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">Rate</span> <span style="color: #85DDFF; font-weight: bold;">r</span>(rate);

    <span style="color: #ff0000;">///////////////////</span><span style="color: #579C4C;">ARM//////////////////////</span>
    <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">ServiceClient</span> <span style="color: #85DDFF; font-weight: bold;">arming_client</span> = n.serviceClient&lt;<span style="color: #339CDB;">mavros_msgs</span>::CommandBool&gt;(<span style="color: #DB8E73;">"/mavros/cmd/arming"</span>);
    <span style="color: #339CDB;">mavros_msgs</span>::<span style="color: #35CDAF;">CommandBool</span> <span style="color: #85DDFF; font-weight: bold;">arm_cmd</span>;
    arm_cmd.request.value = <span style="color: #339CDB;">true</span>;

    <span style="color: #6959ce;">if</span> (arming_client.call(arm_cmd) &amp;&amp; arm_cmd.response.success)
    {
        ROS_INFO(<span style="color: #DB8E73;">"Vehicle armed"</span>);
    } <span style="color: #6959ce;">else</span> {
        ROS_ERROR(<span style="color: #DB8E73;">"Failed arming or disarming"</span>);
    }

    <span style="color: #ff0000;">/////////////////</span><span style="color: #579C4C;">TAKEOFF////////////////////</span>
    <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">ServiceClient</span> <span style="color: #85DDFF; font-weight: bold;">takeoff_client</span> = n.serviceClient&lt;<span style="color: #339CDB;">mavros_msgs</span>::CommandTOL&gt;(<span style="color: #DB8E73;">"/mavros/cmd/takeoff"</span>);
    <span style="color: #339CDB;">mavros_msgs</span>::<span style="color: #35CDAF;">CommandTOL</span> <span style="color: #85DDFF; font-weight: bold;">takeoff_cmd</span>;
    takeoff_cmd.request.altitude = 10;
    takeoff_cmd.request.latitude = 0;
    takeoff_cmd.request.longitude = 0;
    takeoff_cmd.request.min_pitch = 0;
    takeoff_cmd.request.yaw = 0;
    <span style="color: #6959ce;">if</span>(takeoff_client.call(takeoff_cmd) &amp;&amp; takeoff_cmd.response.success){
        ROS_INFO(<span style="color: #DB8E73;">"Okay Takeoff"</span>);
    }<span style="color: #6959ce;">else</span>{
        ROS_ERROR(<span style="color: #DB8E73;">"Failed Takeoff"</span>);
    }

    <span style="color: #ff0000;">/////////////////</span><span style="color: #579C4C;">DO STUFF///////////////////</span>
    sleep(10);


    <span style="color: #ff0000;">///////////////////</span><span style="color: #579C4C;">LAND/////////////////////</span>
    <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">ServiceClient</span> <span style="color: #85DDFF; font-weight: bold;">land_client</span> = n.serviceClient&lt;<span style="color: #339CDB;">mavros_msgs</span>::<span style="color: #35CDAF;">CommandTOL</span>&gt;(<span style="color: #DB8E73;">"/mavros/cmd/land"</span>);
    <span style="color: #339CDB;">mavros_msgs</span>::<span style="color: #35CDAF;">CommandTOL</span> <span style="color: #85DDFF; font-weight: bold;">land_cmd</span>;
    land_cmd.request.altitude = 0;
    land_cmd.request.latitude = 0;
    land_cmd.request.longitude = 0;
    land_cmd.request.min_pitch = 0;
    land_cmd.request.yaw = 0;
    <span style="color: #6959ce;">if</span>(land_client.call(land_cmd) &amp;&amp; land_cmd.response.success){
        ROS_INFO(<span style="color: #DB8E73;">"Okay Land"</span>);
    }<span style="color: #6959ce;">else</span>{
        ROS_ERROR(<span style="color: #DB8E73;">"Failed Land"</span>);
    }

    <span style="color: #6959ce;">while</span> (n.ok())
    {
      <span style="color: #339CDB;">ros</span>::spinOnce();
      r.sleep();
    }

    <span style="color: #6959ce;">return</span> 0;

}
</pre>
</div>

<p>
<code>\~/catkin_ws/src/drone_control/CMakeLists.txt</code> íì¼ ëì ë¤ì 3ì¤ ì¶ê°
</p>

<div class="org-src-container">
<pre class="src src-cmake">add_executable(takeoff_and_land src/takeoff_and_land.cpp)
target_link_libraries(takeoff_and_land ${catkin_LIBRARIES})
</pre>
</div>


<ul class="org-ul">
<li>ì¤í: <code>rosrun drone_control takeoff_and_land</code></li>
</ul>
</div>
</div>

<div id="outline-container-orgb133a15" class="outline-3">
<h3 id="orgb133a15"><span class="section-number-3">9.3</span> ìë¡ì´ ë¸ë ë§ë¤ê¸°: <code>offb_node</code></h3>
<div class="outline-text-3" id="text-9-3">
<p>
<code>drone_control</code> í¨í¤ì§ì <code>offb_node</code> ë¸ëë¥¼ ë§ë¤ì´ ë³´ì.
</p>

<p>
2m ì´ë¥.
</p>

<div class="org-src-container">
<pre class="src src-c++"><span style="color: #777778;">/**</span>
<span style="color: #777778;"> * </span><span style="color: #339CDB;">@file</span><span style="color: #777778;"> offb_node.cpp</span>
<span style="color: #777778;"> * </span><span style="color: #339CDB;">@brief</span><span style="color: #777778;"> Offboard control example node, written with MAVROS version 0.19.x, PX4 Pro Flight</span>
<span style="color: #777778;"> * Stack and tested in Gazebo SITL</span>
<span style="color: #777778;"> */</span>

<span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">&lt;ros/ros.h&gt;</span>
<span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">&lt;geometry_msgs/PoseStamped.h&gt;</span>
<span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">&lt;mavros_msgs/CommandBool.h&gt;</span>
<span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">&lt;mavros_msgs/SetMode.h&gt;</span>
<span style="color: #85DDFF; font-weight: bold;">#include</span> <span style="color: #DB8E73;">&lt;mavros_msgs/State.h&gt;</span>

<span style="color: #339CDB;">mavros_msgs</span>::<span style="color: #35CDAF;">State</span> <span style="color: #85DDFF; font-weight: bold;">current_state</span>;
<span style="color: #35CDAF;">void</span> <span style="color: #D9DAA2;">state_cb</span>(<span style="color: #6959ce;">const</span> <span style="color: #339CDB;">mavros_msgs</span>::<span style="color: #339CDB;">State</span>::<span style="color: #35CDAF;">ConstPtr</span>&amp; <span style="color: #85DDFF; font-weight: bold;">msg</span>){
    current_state = *msg;
}

<span style="color: #35CDAF;">int</span> <span style="color: #D9DAA2;">main</span>(<span style="color: #35CDAF;">int</span> <span style="color: #85DDFF; font-weight: bold;">argc</span>, <span style="color: #35CDAF;">char</span> **<span style="color: #85DDFF; font-weight: bold;">argv</span>)
{
    <span style="color: #339CDB;">ros</span>::init(argc, argv, <span style="color: #DB8E73;">"offb_node"</span>);
    <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">NodeHandle</span> <span style="color: #85DDFF; font-weight: bold;">nh</span>;

    <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">Subscriber</span> <span style="color: #85DDFF; font-weight: bold;">state_sub</span> = nh.subscribe&lt;<span style="color: #339CDB;">mavros_msgs</span>::<span style="color: #35CDAF;">State</span>&gt;
            (<span style="color: #DB8E73;">"mavros/state"</span>, 10, state_cb);
    <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">Publisher</span> <span style="color: #85DDFF; font-weight: bold;">local_pos_pub</span> = nh.advertise&lt;<span style="color: #339CDB;">geometry_msgs</span>::PoseStamped&gt;
            (<span style="color: #DB8E73;">"mavros/setpoint_position/local"</span>, 10);
    <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">ServiceClient</span> <span style="color: #85DDFF; font-weight: bold;">arming_client</span> = nh.serviceClient&lt;<span style="color: #339CDB;">mavros_msgs</span>::CommandBool&gt;
            (<span style="color: #DB8E73;">"mavros/cmd/arming"</span>);
    <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">ServiceClient</span> <span style="color: #85DDFF; font-weight: bold;">set_mode_client</span> = nh.serviceClient&lt;<span style="color: #339CDB;">mavros_msgs</span>::SetMode&gt;
            (<span style="color: #DB8E73;">"mavros/set_mode"</span>);

    <span style="color: #ff0000;">//</span><span style="color: #579C4C;">the setpoint publishing rate MUST be faster than 2Hz</span>
    <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">Rate</span> <span style="color: #85DDFF; font-weight: bold;">rate</span>(20.0);

    <span style="color: #ff0000;">// </span><span style="color: #579C4C;">wait for FCU connection</span>
    <span style="color: #6959ce;">while</span>(<span style="color: #339CDB;">ros</span>::ok() &amp;&amp; <span style="color: #85DDFF; font-weight: bold;">!</span>current_state.connected){
        <span style="color: #339CDB;">ros</span>::spinOnce();
        rate.sleep();
    }

    <span style="color: #339CDB;">geometry_msgs</span>::<span style="color: #35CDAF;">PoseStamped</span> <span style="color: #85DDFF; font-weight: bold;">pose</span>;
    pose.pose.position.x = 0;
    pose.pose.position.y = 0;
    pose.pose.position.z = 2;

    <span style="color: #ff0000;">//</span><span style="color: #579C4C;">send a few setpoints before starting</span>
    <span style="color: #6959ce;">for</span>(<span style="color: #35CDAF;">int</span> <span style="color: #85DDFF; font-weight: bold;">i</span> = 100; <span style="color: #339CDB;">ros</span>::ok() &amp;&amp; i &gt; 0; --i){
        local_pos_pub.publish(pose);
        <span style="color: #339CDB;">ros</span>::spinOnce();
        rate.sleep();
    }

    <span style="color: #339CDB;">mavros_msgs</span>::<span style="color: #35CDAF;">SetMode</span> <span style="color: #85DDFF; font-weight: bold;">offb_set_mode</span>;
    offb_set_mode.request.custom_mode = <span style="color: #DB8E73;">"OFFBOARD"</span>;

    <span style="color: #339CDB;">mavros_msgs</span>::<span style="color: #35CDAF;">CommandBool</span> <span style="color: #85DDFF; font-weight: bold;">arm_cmd</span>;
    arm_cmd.request.value = <span style="color: #339CDB;">true</span>;

    <span style="color: #339CDB;">ros</span>::<span style="color: #35CDAF;">Time</span> <span style="color: #85DDFF; font-weight: bold;">last_request</span> = <span style="color: #339CDB;">ros</span>::<span style="color: #339CDB;">Time</span>::now();

    <span style="color: #6959ce;">while</span>(<span style="color: #339CDB;">ros</span>::ok()){
        <span style="color: #6959ce;">if</span>( current_state.mode != <span style="color: #DB8E73;">"OFFBOARD"</span> &amp;&amp;
            (<span style="color: #339CDB;">ros</span>::<span style="color: #339CDB;">Time</span>::now() - last_request &gt; <span style="color: #339CDB;">ros</span>::Duration(5.0))){
            <span style="color: #6959ce;">if</span>( set_mode_client.call(offb_set_mode) &amp;&amp;
                offb_set_mode.response.mode_sent){
                ROS_INFO(<span style="color: #DB8E73;">"Offboard enabled"</span>);
            }
            last_request = <span style="color: #339CDB;">ros</span>::<span style="color: #339CDB;">Time</span>::now();
        } <span style="color: #6959ce;">else</span> {
            <span style="color: #6959ce;">if</span>( <span style="color: #85DDFF; font-weight: bold;">!</span>current_state.armed &amp;&amp;
                (<span style="color: #339CDB;">ros</span>::<span style="color: #339CDB;">Time</span>::now() - last_request &gt; <span style="color: #339CDB;">ros</span>::Duration(5.0))){
                <span style="color: #6959ce;">if</span>( arming_client.call(arm_cmd) &amp;&amp;
                    arm_cmd.response.success){
                    ROS_INFO(<span style="color: #DB8E73;">"Vehicle armed"</span>);
                }
                last_request = <span style="color: #339CDB;">ros</span>::<span style="color: #339CDB;">Time</span>::now();
            }
        }

        local_pos_pub.publish(pose);

        <span style="color: #339CDB;">ros</span>::spinOnce();
        rate.sleep();
    }

    <span style="color: #6959ce;">return</span> 0;
}
</pre>
</div>

<ul class="org-ul">
<li>ì¤í: <code>rosrun drone_control offb_node</code></li>
</ul>
</div>

<div id="outline-container-orgdbbe45b" class="outline-4">
<h4 id="orgdbbe45b"><span class="section-number-4">9.3.1</span> launch íì¼ì ì´ì©íì¬ ë¸ë íë²ì ì¤í (ìµì)</h4>
<div class="outline-text-4" id="text-9-3-1">
<p>
roscore, gazebo, mavros, offb<sub>node</sub> ë¸ëë¥¼ íë²ì ì¤ííê¸° ìí´ì roslaunchë¥¼ ì´ì©í´ë³´ì.
</p>

<p>
<code>~/catkin_ws/src/drone_control/launch/offb_node.launch</code> íì¼ì ë¤ì ë´ì© ì¶ê°
</p>
<pre class="example">
&lt;launch&gt;
    &lt;node name="offb_node" pkg="drone_control" type="offb_node"/&gt;
    &lt;include file="$(find px4)/launch/mavros_posix_sitl.launch"&gt;
      &lt;arg name="vehicle" value="iris"/&gt;
    &lt;/include&gt;
&lt;/launch&gt;
</pre>

<p>
<code>~/.bashrc</code> íì¼ì ëì ë¤ì ë´ì©ì ì¶ê°
íê²½ ë³ì ì¶ê°
</p>
<pre class="example">
PX4_SRC_DIR=$HOME/Firmware
source $PX4_SRC_DIR/Tools/setup_gazebo.bash $PX4_SRC_DIR $PX4_SRC_DIR/build/px4_sitl_default &gt; /dev/null
export ROS_PACKAGE_PATH=$ROS_PACKAGE_PATH:$PX4_SRC_DIR:$PX4_SRC_DIR/Tools/sitl_gazebo
</pre>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #C586C0;">source</span> ~/.bashrc
catkin build
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">roslaunch drone_control offb_node.launch
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org1bf1d3e" class="outline-3">
<h3 id="org1bf1d3e"><span class="section-number-3">9.4</span> ìë¡ì´ ë¸ë ë§ë¤ê¸°: <code>circle</code></h3>
<div class="outline-text-3" id="text-9-4">
<p>
ì¶ì²: <a href="https://github.com/Jaeyoung-Lim/modudculab_ros/blob/master/src/pub_setpoints_traj.cpp">https://github.com/Jaeyoung-Lim/modudculab_ros/blob/master/src/pub_setpoints_traj.cpp</a>
</p>

<pre class="example">
/**
 * @file circle.cpp
 * @brief offboard example node, written with mavros version 0.14.2, px4 flight
 * stack and tested in Gazebo SITL
 */

#include &lt;ros/ros.h&gt;
#include &lt;geometry_msgs/PoseStamped.h&gt;
#include &lt;mavros_msgs/CommandBool.h&gt;
#include &lt;mavros_msgs/SetMode.h&gt;
#include &lt;mavros_msgs/State.h&gt;
#include "math.h"

double r;
double theta;
double count=0.0;
double wn;

mavros_msgs::State current_state;
void state_cb(const mavros_msgs::State::ConstPtr&amp; msg){
    current_state = *msg;
}

int main(int argc, char **argv)
{
    ros::init(argc, argv, "circle");
    ros::NodeHandle nh;

    ros::Subscriber state_sub = nh.subscribe&lt;mavros_msgs::State&gt;
            ("mavros/state", 10, state_cb);
    ros::Publisher local_pos_pub = nh.advertise&lt;geometry_msgs::PoseStamped&gt;
            ("mavros/setpoint_position/local", 10);
    ros::ServiceClient arming_client = nh.serviceClient&lt;mavros_msgs::CommandBool&gt;
            ("mavros/cmd/arming");
    ros::ServiceClient set_mode_client = nh.serviceClient&lt;mavros_msgs::SetMode&gt;
            ("mavros/set_mode");

    //the setpoint publishing rate MUST be faster than 2Hz
    ros::Rate rate(20.0);


    nh.param("pub_setpoints_traj/wn", wn, 1.0);
    nh.param("pub_setpoints_traj/r", r, 1.0);
    // wait for FCU connection
    while(ros::ok() &amp;&amp; current_state.connected){
        ros::spinOnce();
        rate.sleep();
    }

    geometry_msgs::PoseStamped pose;
    pose.pose.position.x = 0;
    pose.pose.position.y = 0;
    pose.pose.position.z = 2;

    //send a few setpoints before starting
    for(int i = 100; ros::ok() &amp;&amp; i &gt; 0; --i){
        local_pos_pub.publish(pose);
        ros::spinOnce();
        rate.sleep();
    }

    mavros_msgs::SetMode offb_set_mode;
    offb_set_mode.request.custom_mode = "OFFBOARD";

    mavros_msgs::CommandBool arm_cmd;
    arm_cmd.request.value = true;

    ros::Time last_request = ros::Time::now();

    while(ros::ok()){
        if( current_state.mode != "OFFBOARD" &amp;&amp;
            (ros::Time::now() - last_request &gt; ros::Duration(5.0))){
            if( set_mode_client.call(offb_set_mode) &amp;&amp;
                offb_set_mode.response.mode_sent){
                ROS_INFO("Offboard enabled");
            }
            last_request = ros::Time::now();
        } else {
            if( !current_state.armed &amp;&amp;
                (ros::Time::now() - last_request &gt; ros::Duration(5.0))){
                if( arming_client.call(arm_cmd) &amp;&amp;
                    arm_cmd.response.success){
                    ROS_INFO("Vehicle armed");
                }
                last_request = ros::Time::now();
            }
        }

        theta = wn*count*0.05;

        pose.pose.position.x = r*sin(theta);
        pose.pose.position.y = r*cos(theta);
        pose.pose.position.z = 2;

        count++;

        local_pos_pub.publish(pose);
        ros::spinOnce();
        rate.sleep();
    }

    return 0;
}
</pre>

<ul class="org-ul">
<li>ì¤í: <code>rosrun drone_control circle</code></li>
</ul>
</div>
<div id="outline-container-org1424c1c" class="outline-4">
<h4 id="org1424c1c"><span class="section-number-4">9.4.1</span> í´ë³´ê¸°: ìì ëë¹ì ìëë¥¼ ë°ê¾¸ì´ ë³´ì. íí¸ (wn, r)</h4>
</div>
</div>

<div id="outline-container-orgb270567" class="outline-3">
<h3 id="orgb270567"><span class="section-number-3">9.5</span> ê³¼ì : í¤ë³´ëë¡ OFFBOARD ëª¨ë ì ì´íê¸°</h3>
<div class="outline-text-3" id="text-9-5">
<ul class="org-ul">
<li><code>offb_node</code> ì½ëë¥¼ ì°¸ê³ íì¬, í¤ë³´ëë¡ x,y,z ìì¹ë¥¼ ì ì´íì¬ ë³´ì.</li>
<li>ì°¸ê³ : <a href="http://wiki.ros.org/teleop_twist_keyboard_cpp">http://wiki.ros.org/teleop_twist_keyboard_cpp</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgc47b79c" class="outline-3">
<h3 id="orgc47b79c"><span class="section-number-3">9.6</span> ì°¸ê³ </h3>
<div class="outline-text-3" id="text-9-6">
<ul class="org-ul">
<li><a href="https://github.com/mavlink/mavros/tree/master/mavros">https://github.com/mavlink/mavros/tree/master/mavros</a></li>
<li><a href="https://github.com/Jaeyoung-Lim/modudculab_ros/blob/master/src/pub_setpoints_traj.cpp">https://github.com/Jaeyoung-Lim/modudculab_ros/blob/master/src/pub_setpoints_traj.cpp</a></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Donghee Park</p>
<p class="date">Created: 2020-08-06 ëª© 08:15</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>